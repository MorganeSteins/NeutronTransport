\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{natbib}
\usepackage[french]{babel}
\usepackage[top=2.5cm, bottom=2.8cm, left=2.7cm, right=2.7cm]{geometry} 
\usepackage{xcolor}
\usepackage{amsmath}
\usepackage{amsfonts,stmaryrd}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{listings}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}

\newcommand{\pp}{\varphi}
\newcommand{\ppt}{\tilde{\varphi}}
\newcommand{\PP}{\mathbb{P}}
\newcommand{\epst}{\tilde{\epsilon}}
\newcommand{\st}{\Sigma_t}
\newcommand{\sa}{\Sigma_a}
\newcommand{\Ssss}{\Sigma_s}
\newcommand{\into}{\int_{-1}^{1}}

\title{TP1 AMS302 - Modélisation et Simulation du transport de particules neutres}
\author{Morgane STEINS et Etienne PEILLON}
\date{Version préliminaire pour le 14/10/2019}

\begin{document}
\maketitle
\vspace{0.5cm}

Nous cherchons à résoudre l'équation du transport neutronique en 1D sur l'intervalle $[0;1]$ et pour tout $\mu \in [1;1]$
\begin{equation}
    \label{eq.transport}
    \mu \frac{\partial \pp}{\partial x} (x,\mu) + \st \pp(x,\mu) = \frac{\Ssss(x)}{2} \into \pp(x,\mu')\ d\mu' + S(x,\mu)
\end{equation}



\section{Solveur Monte-Carlo}

% \subsection{Méthode Monte-Carlo}

% Le principe de la méthode de Monte-Carlo pourrait être résumé par le tirage de
% variable aléatoire. Dire cela n'est clairement pas suffisant, et c'est ce que
% nous allons voir.

% \subsubsection{Calcul d'une intégrale simple}

% La première étape d'un solveur Monte-Carlo consiste à simplement approximer une
% intégrale. Ainsi, on va considérer \og l'équation \fg intégrale :
% \begin{equation*}
%     \chi(x) = \int_\Omega \psi(x,y) \cdot f_y (y) dy
% \end{equation*}

% Le principe de calcul de cette intégrale est le suivant :
% \begin{itemize}
% \item on tire un nombre $N$ de point aléatoire $y_i$ dans $\Omega$ suivant la
% loi $f_y$,
% \item on approxime l'intégrale par $\chi_{approx}(x) = \dfrac{1}{N}
% \sum\limits_{i=1}^N \psi(x,y_i)$.
% \end{itemize}

% La convergence est assurée par la loi des grands nombres. Il faut cependant une
% précision sur le calcul de l'intégrale. Pour cela, on se sert d'un intervale de
% confiance à $95$ \%, calculé via le théorème central limite.

% {\huge Rajouter l'intervale de de confiance}

% \subsubsection{Calcul de la solution d'une équation intégrale}

% On souhaite à présent calculer la solution de l'équation intégrale
% \begin{equation*}
%     \chi (x) = S(x) + \int_\Omega K(x,y) \chi(y) dy 
% \end{equation*}

% Une solution formelle du problème consiste à écrire que $\chi (x) = \sum_{n\geq
% 1} \chi^n(x)$ où $\chi^0(x) = S(x)$ et $\chi^n(x) = \int_\Omega K(x,y)
% \chi^{n-1}(x)$.

% Pour calculer cette somme, la méthode de Monte-Carlo utilise des marches aléatoires.
% Pour ce faire, on prends $N$ particules Monte-Carlo et on les fait \og marcher
% \fg de la manière qui suit :
% \begin{itemize}
% \item La position initiale est tirée suivant la densité $S(y)/\int_\Omega S(x)dx$. Cela
% nous permet de calculer $\chi^0(x)$. Ce premier pas représente les positions
% initiales des particules Monte-Carlo.
% \item \dots
% \end{itemize}

% \subsubsection{Simulation à partir des trajectoires d'une population neutronique}

% On suppose qu'on a à disposition $N$ neutron ou particules Monte-Carlo
% $(x_n^t)$. Le flux neutroniq



\subsection{Préliminaires}
Tout d'abord nous justifions la forme du libre parcours d'un neutron. Une surface efficace macroscopique $\Sigma$ caractérise la probabilité d'intéraction sur un petit intervale $\delta l$ 
$$P_{\text{interaction}}([x;x+\delta l]) = \Sigma \delta l$$ 
Lorsque l'on projette cette distance sur l'axe des abscisses, on fait apparaitre le cosinus de l'angle entre le vecteur directeur du déplacement et $\vec{x}$ qui est définit par $\mu$ dans ce TP.
D'où en 1D $P_{\text{interaction}}(x) = \frac{\Sigma}{\mu} \delta l $

On peut voir le libre parcours du neutron de deux manières différentes. 
La première est de considérer qu'il s'agit d'une sorte comme un "temps" de survie et utiliser le fait que ce genre de phénomène se modélise avec une loi exponentielle. 
On peut aussi utiliser faire une démonstration plus physique. 
On découpe l'intervalle $[0;1]$ en $N$ sous-intervalles de longeur $dx$ et on considère partir du point 0. 
La probabilité d'interaction au point $x=idx$ s'obtient en considérant qu'il y a une intercation dans l'intervalle $i$ mais pas dans les précédents ce qui donne
\begin{equation*}
    P_{\text{interaction}}(x \in [idx;(i+1)dx]) = \frac{\Sigma}{\mu}(1-\frac{\Sigma}{\mu}dx)^{i}
\end{equation*}

Le passage à la limite $N \rightarrow \infty$ donne la densité de probabilité d'interagir au point $x$ et pas avant, donc la densité de probabilité du libre parcours $f$:
$f(x) = \frac{\Sigma}{\mu}e^{-\frac{\Sigma}{\mu}x}$

On vérifie immédiatement que $\int_0^{\infty} f(x) \text{d}x = 1$.

Pour échantillonner une variable aléatoire selon une loi, on peut inverser sa fonction de répartition si elle est connue. 
La fonction de répartition $F$ du libre parcours moyen s'écrit
\begin{equation*}
    F(x) = \int_0^x f(t) \text{d}t = \int_0^x \frac{\Sigma}{\mu}e^{-\frac{\Sigma}{\mu}t} = 1- e^{-\frac{\Sigma}{\mu}x}
\end{equation*}

Pour l'inverser on résoud $y = F(x)$
\begin{equation*}
    y = 1- e^{-\frac{\Sigma}{\mu}x}  \iff  x = \frac{\mu}{\Sigma} \text{log}(1-y) = F^{-1}(y)
\end{equation*}

Pour tirer une variable aléatoire selon la loi $F$, on tire $y$ selon une loi uniforme sur $[0;1]$ et on calcule $F^{-1}(y)$.

\vspace{0.1cm}
La méthode Monte-Carlo consiste à simuler un grand nombre de trajectoires de neutrons et en déduire le flux neutronique par la loi des grands nombres. 

\vspace{0.2cm}
\subsection{Matériau purement absorbant}
\subsubsection{Source ponctuelle}
On commence avec le cas particulièrement simple $\Sigma_s = 0$. 
Il n'y a pas de scattering, les neutrons émis par une source avec une direction $\mu$ continuent simplement dans cette direction jusqu'à être absorbés.

Le cas le plus simple est celui d'une source ponctuelle en $0$. L'équation devient 
\begin{equation}
    \label{eq.homog.point}
    \mu \frac{\partial \psi}{\partial x} (x,\mu) + \st \psi(x,\mu) = \delta_0(x)
\end{equation}
avec pour condition aux limites un flux entrant nul, c'est à dire 
$$ \psi(0,\mu >0) = \psi(1,\mu<0) = 0 $$ 
On note la solution de ce problème $\psi$ car elle nous sera utile dans la suite pour des cas plus complexes. 
Il s'agit de la solution élémentaire.

Pour trouver la solution plaçons nous à $\mu>0$ puisque pour $\mu<0$ les neutrons émis en $0$ sortent immédiatement du domaine, le flux est nul en tout point.
On multiplie l'équation par $e^{\frac{\st x}{\mu}}$ et on intègre entre $0$ et $x$

\begin{align*}
    \int_0^x \left( \mu \frac{\partial \psi}{\partial x} (t,\mu)  + \st
    \psi(t,\mu)\right) e^\frac{\st t}{\mu} dt &= \int_0^x \delta_0(t) dt \\
    \iff  \mu \psi(x,\mu) e^{\frac{\st x}{\mu}} &= \mu \psi(0,\mu) + 1 \\
    \iff  \psi(x,\mu) &= \frac{1}{\mu} e^{-\frac{\st x}{\mu}}
\end{align*}


Pour simuler ce flux neutronique avec un solveur Monte-Carlo on commence par tirer une direction de départ $\mu_0$ avec une loi uniforme $\mathcal{U}[-1,1]$.
Le point de départ est $x_0 = 0$ puisque la seule source se trouve en ce point. Puis on tire la distance parcourue par ce neutron selon la loi du libre parcours établie précédemment. 
Le neutron finit sa trajectoire au point $x_1$ avec toujours la direction $\mu_0$. 
Ceci donne alors une distributions de neutrons avec une densité $f_{\psi}$ égale au libre parcours.

\begin{equation*}
    f_{\psi}(x_1) = \frac{\st}{\mu}e^{-\frac{\st}{\mu}x_1} = \st \psi(x_1,\mu)
\end{equation*}

La probabilité pour un neutron de se trouver dans un intervalle $[a,b]$ est donc donnée par l'intégrale de $\pp$ sur cet interval à un facteur $\st$ près.
En prenant un intervalle de longueur $dx$ négligable devant $1$ (la taille de notre intervalle d'étude) on obtient

\begin{equation}
    \psi(x,\mu) = \lim\limits_{dx \rightarrow 0} \frac{\PP(x_1 \in [x-dx/2,x+dx/2] | \mu)}{\st dx}
\end{equation}

Pour approcher numériquement $\psi$, on commence par discrétiser l'intervale
$[0,1]$ en sous-intervalles $[x_i,x_{i+1}]$, de longueur $h$. Puis on simule un grand nombre de particule
Monte-Carlo, suivant le principe suivant :
\begin{enumerate}
    \item toutes les particules Monte-carlo ont pour position initiale $x=0$,
\item pour chaque particule, on tire une distance de libre parcours suivant la
loi $f_\psi$ et on note la position d'arrivée de chaque particule,
\item on retient $C_0^i$ égal au nombre de particule dans
l'intervalle $[x_i,x_{i+1}]$,
\item on relance les particules encore dans l'intervalle, puis on compte à
nouveau le nombre de particule dans chaque intervalle, qu'on retiens dans
$C_1^i$ et ainsi de suite\dots
\end{enumerate}
Finalement, la fréquence totale est $freq^i = \frac{1}{N} \sum_n C_n^i$.
On peut ainsi approximer $\psi(x_{i+1/2},\mu)$ par $\frac{1}{\Sigma_t h} freq^i$.

% En approximant la probabilité par la fréquence lors d'un grand nombre de tirage, nous sommes bien capables de trouver $\psi(x,\mu)$ pour tout $x$.
\medskip
Maintenant que nous avons un algorithme nous pouvons nous concentrer sur l'implémentation.
Commençons par étudier l'allure de la solution $\psi$ pour différentes valeurs de $\mu$.
\begin{figure}[htp!]
    \centering
    \includegraphics[scale=0.45]{Figures/Q3_fx_solution.png}
    \caption{$\psi(x,\mu)$}
    \label{fig:q3.allures}
\end{figure}
Plus $\mu$ se rapproche de $0$ plus sa densité est centrée sur 0. 
La limite pour $\mu=0$ est le dirac en 0. 
En effet si le neutron part à la verticale il sera aussi absorbé à $x=0$.

Il s'agit maintenant de comparer ses densités théoriques aux résultats de notre simulation.
Une question pratique se pose : quelle valeur donner à $dx$ ? 
En effet ce paramètre n'est en rien déterminé par le problème physique ou la méthode Monte-Carlo.
Empiriquement, s'il est trop grand l'approximation de l'intégrale est fausse et s'il est trop petit il n'y aura aucune trajectoire qui mène à l'intervalle $[x-dx/2;x+dx/2]$.
Nous voulons limiter le nombre d'intervalles de calcul pour représenter les solutions de manière visible et feront ici 25 intervalles.

\begin{figure}[htp!]
    \centering
    \begin{subfigure}{.49\textwidth}
        \centering
        \includegraphics[scale=0.45]{Figures/Q4_simulation.png}
        \caption{Solution et simulations pour $\mu=1$}
        \label{fig:q4.simul}
    \end{subfigure}
    \begin{subfigure}{.49\textwidth}
        \centering
        \includegraphics[scale=0.45]{Figures/q4__ic_n1e6_nb25.png}
        \caption{Intervalle de confiance $N=10^6$}
        \label{fig:q4.ic}
    \end{subfigure}
    \caption{Etude de la simulation de $\psi(x,\mu=1)$}
    \label{fig:q4}
\end{figure}
On a représenté sur la figure (\ref{fig:q4.simul}) l'allure de la solution par simulation Monte-Carlo. Elle est constante par morceaux pour chaque intervalle d'approximation où la valeur moyenne est assimilée à l'intégrale.

Pour la représentation des intervalles de confiance, on remarque que pour $N=10^6$ simulations il est invisible sur la figure puisque de largeur évoluant en l'inverse de $\sqrt{N}$, il est ici de largeur de l'ordre de $10^{-3}$. Les points donnent toutefois l'impression d'être compris dedans ou très proches. Nous avons tracé l'intervalle de confiance à $95\%$ pour une gaussienne puisque par théorème central limite la moyenne empirique que nous calculons tend vers l'espérence.



\vspace{0.5cm}
\subsubsection{Source uniforme}
On s'intéresse ensuite au cas d'une source $S$ uniforme et unitaire sur tout l'intervalle $[0,1]$.
Comme on écrit $S(x) = \int_0^1 S(t) \delta_x(t)dt$ on peut réutiliser l'étude faite avec une source ponctuelle. Cette source peut maintenant être située en tout point de l'intervalle d'étude. 
Par translation on obtient la solution de l'équation pour une source ponctuelle en $x_0$ pour $\mu>0$
\begin{equation}
    \label{eq:sol.point.x0}
    \psi_{x_0}(x,\mu) = 1_{(x>x_0)}\frac{1}{\mu} e^{-\frac{\st (x-x_0)}{\mu}} 
\end{equation}
Par symétrie on trouve la solution pour $\mu<0$ en changeant simplement l'indicatrice $1_{(x<x_0)}$.

\vspace{0.1cm}
Par linéarité la solution de notre equation pour $S=1$ s'écrit
\begin{equation*}
    \pp(x,\mu) = \int_0^1 \psi_{x_0}(x,\mu)\ dx_0
\end{equation*} 

Dans notre démarche Monte-Carlo nous tirons maintenant $x_0$ le point de départ selon la loi de probabilité induite par la source. 
Comme la source est constante on tire $x_0$ selon une loi uniforme $\mathcal{U}[0,1]$. 
On tire $\mu_0$ comme précédemment.
Pour connaître la densité $f_{\mu_0}(x_1)$ on utilise la formule de Bayes sur les densités conditionnelles
\begin{equation*}
    f(x_1|\mu_0) = \int_0^1 f_{\psi}(x_1|x_0,\mu_0)f_{\mu_0}(x_0)\ dx_0
\end{equation*}

$f_{\psi}(x_1|x_0,\mu_0)$ est donnée par la solution (\ref{eq:sol.point.x0}) qui est le libre parcours depuis $x_0$ à $\st$ près et $f_{\mu_0}(x_0)$ par la densité de la source, ici $1$.
On obtient la densité $f(x_1)$
$$ f(x_1|\mu_0) = \st \int_0^1 \psi_{x_0}(x,\mu) \ dx  = \st \pp(x,\mu)$$

\vspace{0.1cm}
Pour obtenir la densité de neutrons totale en un point $x$ indépendamment de leur direction $\mu$, il faut considérer les probabilités conditionnelles selon $\mu$ également.
Comme le tirage de $\mu$ est uniforme entre $-1$ et $1$, sa densité est $\frac{1}{2}$. 
On intègre sur $\mu$ pour obtenir la densité moyenne $ \tilde{\pp}(x) = \into \pp(x,\mu) \ d\mu $.
On a alors
$$ f(x_1) = \frac{1}{2} \into f(x_1|\mu_0) \ d\mu_0 = \frac{\st}{2} \into \pp(x_1,\mu) \ d\mu  = \frac{\st}{2} \tilde{\pp}(x) $$

Nous sommes donc capable d'approximer $\pp$ mais aussi $\tilde{\pp}$ par méthode Monte-Carlo

\begin{equation}
    \label{eq:sol.unif}
    \pp(x,\mu_0) = \frac{\PP(x_1 \in [x-dx/2,x+dx/2]| \mu_0)}{\st dx} \hspace{1cm} \tilde{\pp}(x) = \frac{\PP(x_1 \in [x-dx/2,x+dx/2])}{2 \st dx}
\end{equation}

\vspace{0.2cm}
Comme pour le cas de la source ponctuelle on regarde d'abord l'allure de la solution en fonction de $\mu>0$ (figure (\ref{fig:q5.allures})). 
Pour $\mu<0$ le cas est symétrique par rapport au centre de l'intervalle.

\begin{figure}[htp!]
    \centering
    \begin{subfigure}{.49\textwidth}
        \centering
        \includegraphics[scale=0.45]{Figures/Q5_fx_solution.png}
        \caption{Allures de $\pp(x,\mu)$}
        \label{fig:q5.allures}
    \end{subfigure}
    \begin{subfigure}{.49\textwidth}
        \centering
        \includegraphics[scale=0.45]{Figures/Q5_vitessesL2_Linfty_cv_025.png}
        \caption{Vitesses de convergence}
        \label{fig:q5.cv}
    \end{subfigure}
    \caption{Etude de la simulation de $\psi(x,\mu=1)$}
    \label{fig:q5}
\end{figure}

La solution est toujours nulle en $x=0$ comme imposé par la condition de flux entrant nul.
La limite quand $\mu \rightarrow $ est un flux constant égal à $1$ sur tout l'intervalle et nul en $0$.

On regarde ensuite les résultats de la simulation Monte-Carlo et encore une fois la vitesse de convergence en focntion du nombre de simulations sur la figure (\ref{fig:q5.cv}).





\vspace{0.5cm}
\subsubsection{Matériau non homogène avec source ponctuelle}
On peut se posee la question de ce qui se passe dans le cas d'un matériau où $\st$ est une fonction de $x$.
On se place dans le cas d'une source homogène avec un matériau de $\st$
\begin{equation*}
\st (x) = \left\{     
    \begin{aligned}
    &1 \hspace{1cm}   x \in S_1=[0;0.3],\\
    &3 \hspace{1cm}   x \in S_2=[0.3;0.7],\\
    &1 \hspace{1cm}   x \in S_3=[0.7;1],
\end{aligned}
    \right.
\end{equation*}
et une source ponctuelle en 0.

On commence par résoudre le cette équation sur $[0;0.3]$ avec $\mu>0$ puisqu'il n'y a pas de source autre qu'en 0. 
La solution est donnée par le calcul de la partie précédente
\begin{equation*}
    \tag{S1}
    \label{eq:sol.S1}
    \pp_1(x,\mu) = \frac{1}{\mu} e^{-\frac{ x}{\mu}} \hspace{1cm} \forall x \in [0;0.3]
\end{equation*}

Pour l'intervalle $[0.3;0.7]$ on peut considérer une source ponctuelle en $x=0.3$ 
\begin{equation*}
    S_2(x,\mu) = \pp_1(0.3,\mu)\delta_{0.3}(x) = \frac{1}{\mu} e^{-\frac{0.3}{\mu}}\delta_{0.3}(x)
\end{equation*}

On résoud le problème exactement de la même façon et on obtient
\begin{equation}
    \tag{S2}
    \label{eq:sol.S2}
    \pp_2(x,\mu) = S_2(0.3,\mu) \frac{1}{\mu} e^{-\frac{3 (x-0.3)}{\mu}} = \frac{1}{\mu^2} e^{-\frac{0.3}{\mu}} e^{-\frac{3(x-0.3)}{\mu}}
\end{equation}

Le même raisonnement donne
\begin{equation}
    \tag{S3}
    \label{eq:sol.S3}
    \pp_3(x,\mu) = \frac{1}{\mu^3} e^{-\frac{0.3}{\mu}} e^{-\frac{3(0.7-0.3)}{\mu}}e^{-\frac{x-0.7}{\mu}}
\end{equation}





\vspace{0.5cm}
\subsection{Matériau diffusant}
\subsubsection{Calcul de l'estimateur de $\pp$}
Nous abandonnons maintenant l'hypothèse d'un matériau purement absorbant et considérons les collisions ($\Ssss \neq 0$).
Nous utilisons la suite des flux $n$ fois collisionnés $\pp^n$ et les différences entre deux itérations $\epsilon^n = \pp^n-\pp^{n-1}$ avec $\epsilon^0 = \pp^0$.
Les flux collisionnés vérifient le système
\begin{equation}
    \label{eq:diffusion}
    \left\{ \begin{aligned}
        \mu \frac{\partial \pp^0}{\partial x} (x,\mu) + \st \pp^0(x,\mu) &=  S(x,\mu)  \\
        \mu \frac{\partial \pp^n}{\partial x} (x,\mu) + \st \pp^n(x,\mu) &=  S(x,\mu) + \frac{\Ssss}{2} \into \pp^{n-1}(x,\mu')\ d\mu' \hspace{1cm} \forall n \geqslant 1
    \end{aligned}
    \right.
\end{equation}
et les $\epsilon^n$ le même système sans source.

Pour simplifier l'étude on considère ici que l'absorbtion est négligeable, i.e. $\st = \Ssss$ et $\sa = 0$.
%Ceci entraine immédiatement que les $\epsilon^n$ sont solution de la même équation que les $\pp^n$.

Nous n'allons ici considérer que le flux moyenné en $\mu$, fonction uniquement de l'espace $\tilde{\pp}(x)$.
Le flux non collisinné $\ppt^0$ est donné par la partie précédente équation (\ref{eq:sol.unif}).

Nous cherchons maintenant à estimer $\ppt^1$, c'est à dire trouver la densité de probabilité d'un point $x_2$ après une collision et 2 libres parcours.
$\epsilon^1$ est solution de 
$$ \mu \frac{\partial \epsilon^1}{\partial x} (x,\mu) + \st \epsilon^1(x,\mu) =  \frac{\Ssss}{2} \into \pp^{0}(x,\mu')\ d\mu'= \frac{\Ssss}{2}  \ppt^{0}(x) $$

On utilise encore une fois le fait que $\ppt^0(x) = \int_0^1 \ppt^0(t)\delta_x(t)\ dt$ pour obtenir par linéarité
\begin{equation}
    \label{eq:epsilon.1}
    \epsilon^1(x,\mu) = \Ssss \int_0^1 \ppt^0(x_1,\mu) \psi_{x_1}(x,\mu) dx_1
\end{equation}


Pour mieux différencier les densités, on ajoute les indices $x$ et $\mu$ pour indiquer sur quelle variable porte la densité $f$.

On utilise la formule de Bayes avec les densités qui donne (en notant $f(0\rightarrow 1)$ la densité de probabilité de continuer entre l'état 0 et l'état 1)
\begin{align*}
    \tilde{f_{x}}(x_2) &= f(0\rightarrow 1)\into f_{\mu}(\mu_1) \int_{0}^1 f_x(x_2|x_1,\mu_1)\tilde{f_x}(x_1)\  dx_1 d\mu_1 \\
    &=\frac{\Ssss}{\st}\into \frac{1}{2} \int_{0}^1 f_{\psi}(x_2|x_1,\mu_1) \times\frac{\st}{2}\ppt^0(x_1) \ dx_1 d\mu_1 \\
    &= \frac{\Ssss}{2} \into \int_{0}^1 \st \psi_{x_1}(x_2,\mu_1) \ppt^0(x_1) \ dx_1 d\mu_1 \\
    &= \frac{\st}{2} \into \epsilon^1(x_2,\mu_1) \hspace{1cm} \text{par l'équation (\ref{eq:epsilon.1})} \\
    &= \st \tilde{\epsilon}^1(x_2)
\end{align*}

Comme $\tilde{\epsilon}^1 = \ppt^1 - \ppt^0$, on peut directement calculer $\ppt^1$ dès qu'on a tiré les trajectoires.
On itère pour tout $n$ et le calcul est identique puisqu'il s'agit d'un processus Markovien, l'état $n$ ne dépend que de l'état $n-1$.
On a
$$\ppt^n = \epst^n + \ppt^{n-1} = \sum_{k=1}^n \epst^k + \ppt^0 $$

On peut donc calculer tous les flux collisinnés. Comme la solution de l'équation de transport neutronique est donnée par la limite des flux quand $n \rightarrow \infty$
on a 
$$\ppt(x) = \sum_{k=1}^\infty \epst^k + \ppt^0$$

Dans la pratique on détermine un critère d'arrêt à $n=m$ dès que deux contributions sont 
"suffisemment proches", i.e. dès que $\epst^m< \eta$ où $\eta$ est un paramètre 
fixé à l'avance qui caractérise la précision de notre simulation.

En intégrant sur un petit intervalle autour de $x$ on obtient une formule explicite pour calculer $\ppt$ avec une simulation Monte-Carlo
\begin{equation}
    \label{eq:sol.MC.diffusion}
    \ppt(x) = \sum_{k=0}^m \frac{\PP(x_{k+1} \in [x;x+dx])}{\st dx}
\end{equation}
L'indice $k+1$ vient du fait que l'on note $x_k$ la position de départ de l'itération $k$ et $x_{k+1}$ sa position d'arrivée. 

\subsubsection{Résultats}
Contrairement aux cas précédents on ne connait pas la solution analytique.

\begin{figure}[htp!]
    \centering
    \begin{subfigure}{.49\textwidth}
        \centering
        \includegraphics[scale=0.45]{Figures/Q8_N10e7.png}
        \caption{Simulation de $\pp(x,\mu)$ pour $N=10^7$ tirages}
        \label{fig:q8.allure}
    \end{subfigure}
    \begin{subfigure}{.49\textwidth}
        \centering
        \includegraphics[scale=0.45]{Figures/Q8_cv_pr_N10e7.png}
        \caption{Vitesses de convergence}
        \label{fig:q5=8.cv}
    \end{subfigure}
    \caption{Etude de la simulation de $\ppt(x)$}
    \label{fig:q8}
\end{figure}
 

 

\vspace{5cm}
\begin{itemize}
    \item faire l'explication de l'estimateur du flux neutronique
    \item Cas scattering : fait mais des questions sur la théorie
    \item Etudier les temps de calcul
    \item Etudier la convergence ($\sqrt{N}$ théoriquement) : en quelle norme ? J'ai 1/4 pour l'instant en norme L2 et $L^\infty$.
\end{itemize}

\end{document}